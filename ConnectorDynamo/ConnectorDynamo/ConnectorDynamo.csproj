<Project Sdk="Microsoft.NET.Sdk.WindowsDesktop">

  <Import Project="Sdk.props" Sdk="Microsoft.NET.Sdk" />

  <PropertyGroup>
    <RootNamespace>Speckle.ConnectorDynamo</RootNamespace>
    <AssemblyName>SpeckleConnectorDynamo</AssemblyName>
    <TargetFramework>net48</TargetFramework>
    <StartAction>Program</StartAction>
    <AssemblyTitle>ConnectorDynamo</AssemblyTitle>
    <Product>ConnectorDynamo</Product>
    <AppendTargetFrameworkToOutputPath>false</AppendTargetFrameworkToOutputPath>
    <StartProgram>C:\Program Files\Dynamo\Dynamo Core\2.7\DynamoSandbox.exe</StartProgram>
    <UseWpf>true</UseWpf>
    <EnableDefaultPageItems>false</EnableDefaultPageItems>
    <RuntimeIdentifier>win-x64</RuntimeIdentifier>
  </PropertyGroup>

  <PropertyGroup>
    <PackageName>SpeckleDynamo2</PackageName>
    <PackageFolder>$(ProjectDir)dist\$(PackageName)\</PackageFolder>
    <BinFolder>$(PackageFolder)bin\</BinFolder>
    <ExtraFolder>$(PackageFolder)extra\</ExtraFolder>
    <DyfFolder>$(PackageFolder)dyf\</DyfFolder>
  </PropertyGroup>
  <ItemGroup>
    <Reference Include="PresentationCore" />
    <Reference Include="PresentationFramework" />
    <Reference Include="System" />
    <Reference Include="System.Core" />
    <Reference Include="System.Drawing" />
    <Reference Include="System.Xaml" />
    <Reference Include="System.Xml.Linq" />
    <Reference Include="System.Data.DataSetExtensions" />
    <Reference Include="Microsoft.CSharp" />
    <Reference Include="System.Data" />
    <Reference Include="System.Xml" />
    <Reference Include="WindowsBase" />
  </ItemGroup>
  <ItemGroup>
    <PackageReference Include="DynamoVisualProgramming.Core" Version="2.8.0.2471" ExcludeAssets="runtime" />
    <PackageReference Include="DynamoVisualProgramming.DynamoServices" Version="2.8.0.2471" ExcludeAssets="runtime" />
    <PackageReference Include="DynamoVisualProgramming.WpfUILibrary" Version="2.8.0.2471" ExcludeAssets="runtime" />
    <PackageReference Include="DynamoVisualProgramming.ZeroTouchLibrary" Version="2.8.0.2471" ExcludeAssets="runtime" />
    <PackageReference Include="MaterialDesignColors" Version="2.0.3" />
    <PackageReference Include="MaterialDesignThemes" Version="4.2.1" />
  </ItemGroup>
  <ItemGroup>
    <ProjectReference Include="..\..\Core\Core\Core.csproj" />
    <ProjectReference Include="..\ConnectorDynamoExtension\ConnectorDynamoExtension.csproj" />
    <ProjectReference Include="..\ConnectorDynamoFunctions\ConnectorDynamoFunctions.csproj" />
  </ItemGroup>
  <ItemGroup>
    <None Include="pkg.json" />
    <EmbeddedResource Remove="SpeckleConnectorDynamoImages.resx" />
    <None Include="SpeckleConnectorDynamoImages.resx" />
    <None Remove="SpeckleConnectorDynamoImages.resources" />
  </ItemGroup>
  <ItemGroup>
    <Compile Update="AccountsNode\AccountsUi.xaml.cs">
      <DependentUpon>AccountsUi.xaml</DependentUpon>
    </Compile>
    <Compile Update="CreateStreamNode\CreateStreamUi.xaml.cs">
      <DependentUpon>CreateStreamUi.xaml</DependentUpon>
    </Compile>
    <Compile Update="ReceiveNode\ReceiveUi.xaml.cs">
      <DependentUpon>ReceiveUi.xaml</DependentUpon>
    </Compile>
    <Compile Update="SendNode\SendUi.xaml.cs">
      <DependentUpon>SendUi.xaml</DependentUpon>
    </Compile>
    <Compile Update="ViewNode\ViewUi.xaml.cs">
      <DependentUpon>SendUi.xaml</DependentUpon>
    </Compile>
  </ItemGroup>
  <ItemGroup>
    <Page Include="AccountsNode\AccountsUi.xaml">
      <SubType>Designer</SubType>
      <Generator>MSBuild:Compile</Generator>
    </Page>
    <Page Include="CreateStreamNode\CreateStreamUi.xaml">
      <SubType>Designer</SubType>
      <Generator>MSBuild:Compile</Generator>
    </Page>
    <Page Include="ReceiveNode\ReceiveUi.xaml">
      <Generator>MSBuild:Compile</Generator>
      <SubType>Designer</SubType>
    </Page>
    <Page Include="Themes\Generic.xaml">
      <SubType>Designer</SubType>
      <Generator>MSBuild:Compile</Generator>
    </Page>
    <Page Include="SendNode\SendUi.xaml">
      <SubType>Designer</SubType>
      <Generator>MSBuild:Compile</Generator>
    </Page>
    <Page Include="ViewNode\ViewUi.xaml">
      <SubType>Designer</SubType>
      <Generator>MSBuild:Compile</Generator>
    </Page>
  </ItemGroup>
  
  <ItemGroup>
    <None Remove="Assets\*.png" />
    <Resource Include="Assets\CreateStream%4032.png" />
    <Resource Include="Assets\Receiver%4032.png" />
    <Resource Include="Assets\Sender%4032.png" />
    <Resource Include="Assets\StreamView%4032.png" />
  </ItemGroup>
  
  <Target Name="BuildIconDll">
    <Message Text="Building icon dll" Importance="high" />
    <GenerateResource Sources="$(ProjectDir)SpeckleConnectorDynamoImages.resx" UseSourcePath="true" OutputResources="$(ProjectDir)SpeckleConnectorDynamoImages.resources" />
    <CSC TargetType="library" Resources="$(ProjectDir)SpeckleConnectorDynamoImages.resources" OutputAssembly="$(ProjectDir)SpeckleConnectorDynamo.customization.dll" />
  </Target>
  
  <Target Name="CopyIconDllToOutput" DependsOnTargets="BuildIconDll" BeforeTargets="Build">
    <Message Text="Adding icon dll to items" Importance="high" />
    <ItemGroup>
      <Content Include="$(ProjectDir)SpeckleConnectorDynamo.customization.dll" Link="SpeckleConnectorDynamo.customization.dll" CopyToOutputDirectory="PreserveNewest" />
    </ItemGroup>
  </Target>
  
  <Target Name="AfterBuildMigrated" AfterTargets="Build">
    <ItemGroup>
      <Dlls Include="$(OutDir)\**\*.*" />
      <PackageJson Include="$(ProjectDir)pkg.json" />
    </ItemGroup>
    <MakeDir Directories="$(ExtraFolder)" Condition="!Exists($(ExtraFolder))">
    </MakeDir>
    <MakeDir Directories="$(DyfFolder)" Condition="!Exists($(DyfFolder))">
    </MakeDir>
    <Copy SourceFiles="@(Dlls)" DestinationFolder="$(BinFolder)\%(RecursiveDir)" />
    <Copy SourceFiles="@(PackageJson)" DestinationFolder="$(PackageFolder)" />
  </Target>

  <Import Project="Sdk.targets" Sdk="Microsoft.NET.Sdk" />

  <!-- Add CopyIconDllToOutput task to the build depends on list, this forces projects using this one to copy over the customization dll too -->
  <PropertyGroup>
    <BuildDependsOn>CopyIconDllToOutput;$(BuildDependsOn)</BuildDependsOn>
  </PropertyGroup>
</Project>
